@echo off
TITLE Crear VM
MODE 110,45


echo Cambiando de directorio...
cd C:\Archivos de programa\Oracle\VirtualBox
echo.

:inicio
SET var=0
cls
echo ------------------------------------------------------------------------------
echo  %DATE% ^| %TIME%
echo ------------------------------------------------------------------------------
echo  1    Crear VM
echo  2    Iniciar VM  
echo  3    Apagar VM  
echo  4    Pausar VM 
echo  5    Renaudar VM
echo  6    Guardar el estado actual de la VM 
echo  7    Restablecer VM 
echo  8    Tomar Snapshot
echo  9    Mostrar Snapshot
echo  10    Restaurar VM a partir de Snapshot
echo  11    Eliminar Snapshot
echo  12    Eliminar VM
echo  13    Salir
echo ------------------------------------------------------------------------------
echo.

SET /p var= ^> Seleccione una opcion [1-13]:

if "%var%"=="0" goto inicio
if "%var%"=="1" goto op1
if "%var%"=="2" goto op2
if "%var%"=="3" goto op3
if "%var%"=="4" goto op4
if "%var%"=="5" goto op5
if "%var%"=="6" goto op6
if "%var%"=="7" goto op7
if "%var%"=="8" goto op8
if "%var%"=="9" goto op9
if "%var%"=="10" goto op10
if "%var%"=="11" goto op11
if "%var%"=="12" goto op12
if "%var%"=="13" goto salir

::Mensaje de error, validación cuando se selecciona una opción fuera de rango
echo. El numero "%var%" no es una opcion valida, por favor intente de nuevo.
echo.
pause
echo.
goto:inicio

:op1
    echo.
    echo. Has elegido la opcion No. 1
    echo.
	:: CREACION DE LA VM ===============================================
	echo Proporcione el nombre de VM:
	set /p dato1=nombreVM= 
	echo Proporcione el SO:
	set /p dato2=SO= 
	echo.
	echo Creando la VM...
	VBoxManage createvm --name "%dato1%" --ostype "%dato2%" --register
	:: ASIGNACION DE MEMORIA ===============================================
	echo Proporcione el tamanio de la memoria de la VM:
	set /p dato3=tamanioVM= 
	echo Proporcione VRAM:
	set /p dato4=vramVM= 
	echo.
	echo Asignando Memoria...
	VBoxManage modifyvm "%dato1%" --cpus 1 --memory "%dato3%" --vram "%dato4%"
    :: ADAPTADOR DE RED ====================================================
    ::VBoxManage modifyvm "%dato1%" --nic2 bridged --bridgeadapter1 eth0
    VBoxManage natnetwork add --netname natnet1 --network "192.168.15.0/24" --enable --dhcp on
    VBoxManage natnetwork modify --netname natnet1 --dhcp on
    VBoxManage natnetwork start --netname natnet1

    VBoxManage natnetwork modify \
    --netname natnet1 --port-forward-4 "ssh:tcp:[]:1022:[192.168.15.5]:22"
	:: CREACION DEL DISCO DURO ===============================================
	echo Proporcione el tamanio del disco duro:
	set /p dato5=tamanioDisco= 
	VBoxManage createhd --filename /path/to/hard_drive_image/"%dato1%".vdi --size "%dato5%"

	echo Agregando controlador de almacenamiento...
	VBoxManage storagectl "%dato1%" --name "SATA Controller" --add sata --bootable on

	echo Conectando el Disco duro al Controlador
	VBoxManage storageattach "%dato1%" --storagectl "SATA Controller" --port 0 --device 0 --type hdd --medium /path/to/hard_drive_image/"%dato1%".vdi

	echo Ultimas configuraciones...
	VBoxManage storagectl "%dato1%" --name "IDE Controller" --add ide
	VBoxManage storageattach "%dato1%" --storagectl "IDE Controller" --port 0  --device 0 --type dvddrive --medium C:\Users\Karina\Downloads\Zorin-OS-15.3-Lite-64-bit.iso
        color 08
    echo.
    pause
    goto:inicio

:op2
    echo.
    echo. Has elegido la opcion No. 2
    echo.
	echo Proporcione el nombre de VM:
	set /p dato1=nombreVM= 
    echo Iniciando la VM...
        VBoxManage startvm "%dato1%"
        color 09
    echo.
    pause
    goto:inicio

:op3
    echo.
    echo. Has elegido la opcion No. 3
    echo.
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
        echo Apagando la VM... 
	    VBoxManage controlvm "%dato1%" poweroff
        color 0A
    echo.
    pause
    goto:inicio
  
:op4
    echo.
    echo. Has elegido la opcion No. 4
    echo.
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
        echo Pausando la VM... 
        VBoxManage controlvm "%dato1%" pause
        color 0B
    echo.
    pause
    goto:inicio

:op5
    echo.
    echo. Has elegido la opcion No. 5
    echo.
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
        echo Renaudando la VM...
        VBoxManage controlvm "%dato1%" resume
        color 0C
    echo.
    pause
    goto:inicio

:op6
    echo.
    echo. Has elegido la opcion No. 6
    echo.
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
        echo Guardando el estado actual de la VM...
        VBoxManage controlvm "%dato1%" savestate
        color 0C
    echo.
    pause
    goto:inicio

:op7
    echo.
    echo. Has elegido la opcion No. 7
    echo.
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
        echo Restableciendo la VM...
        VBoxManage controlvm "%dato1%" reset
        color 0C
    echo.
    pause
    goto:inicio

:op8
    echo.
    echo. Has elegido la opcion No. 8
    echo.
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
    echo Proporcione el nombre del Snapshot: 
    set /p snap=nombreSnapshot= 
        echo Tomando Snapshot...
        VBoxManage snapshot "%dato1%" take "%snap%"
        color 0C
    echo.
    pause
    goto:inicio

:op9
    echo.
    echo. Has elegido la opcion No. 9
    echo.
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
	echo Snapshot creadas:
	VBoxManage snapshot "%dato1%" list
        color 0C
    echo.
    pause
    goto:inicio

:op10
    echo.
    echo. Has elegido la opcion No. 10
    echo.
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
    echo Proporcione el nombre del Snapshot: 
    set /p snap=nombreSnapshot= 
	echo Restaurando VM...
	VBoxManage snapshot "%dato1%" restore "%snap%"
        color 0C
    echo.
    pause
    goto:inicio

:op11
    echo.
    echo. Has elegido la opcion No. 11
    echo.
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
    echo Proporcione el nombre del Snapshot: 
    set /p snap=nombreSnapshot= 
	echo Eliminado Snapshot...
	VBoxManage snapshot "%dato1%" delete "%snap%"
        color 0C
    echo.
    pause
    goto:inicio

:op12
    echo.
    echo. Has elegido la opcion No. 12
    echo.
    echo Proporcione el nombre de VM:
    set /p dato1=nombreVM= 
	echo Eliminado VM...
	VBoxManage unregistervm --delete "%dato1%"
        color 0C
    echo.
    pause
    goto:inicio
:salir
    @cls&exit