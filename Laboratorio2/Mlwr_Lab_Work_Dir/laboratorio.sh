#!/bin/bash

# Verificar que se proporcionaron dos argumentos
if [ $# -ne 2 ]; then
    echo "Uso: $0 archivo_json archivo"
    exit 1
fi

# Verificar que el archivo JSON existe
if [ ! -f $1 ]; then
    echo "Error: archivo JSON no encontrado"
    exit 1
fi

# Verificar que el archivo existe
if [ ! -f $2 ]; then
    echo "Error: archivo no encontrado"
    exit 1
fi

# Leer el archivo JSON
herramientas=$(jq -r '.herramientas[]' $1)

# Crear un directorio para los resultados
dir_resultados=$(date +%Y%m%d_%H%M%S)
mkdir Experimentos/$dir_resultados

# Realizar el análisis estático
for herramienta in $herramientas; do
    case $herramienta in
        "file")
            resultado=$(file $2)
            ;;
        "exiftool")
            resultado=$(exiftool $2)
            ;;
        "md5sum")
            resultado=$(md5sum $2)
            ;;
        "sha1sum")
            resultado=$(sha1sum $2)
            ;;
        "sha256sum")
            resultado=$(sha256sum $2)
            ;;
        *)
            echo "Error: herramienta desconocida"
            exit 1
    esac
    echo "$resultado" > "Experimentos/${dir_resultados}/${herramienta}_$(date +%Y%m%d_%H%M%S).txt"
done

echo "Resultados almacenados en el directorio Experimentos/${dir_resultados}"
