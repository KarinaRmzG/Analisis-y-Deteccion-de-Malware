@echo off
rem variables por default
::set usuario=embo
::set servidor=192.168.10.183
set usuario=kary
::set servidor=192.168.1.100




:menu
cls
echo ------------------------------------------------------------------------------
echo  %DATE% ^| %TIME%
echo ------------------------------------------------------------------------------
echo Seleccione una opcion:
echo 0. Tomar
echo 1. Restaurar VM a partir de Snapshot
echo 2. Mandar los archivos a VM
echo 3. Analizar Archivo
echo 4. Analizar Carpeta
echo 5. Analisis especifico de un archivo de configuracion
echo 6. Analisis especifico de un archivo de configuracion con ruta
echo 10. Salir

set /p opcion=Ingrese una opcion:

if "%opcion%"=="0" goto opcion0
if "%opcion%"=="1" goto opcion1
if "%opcion%"=="2" goto opcion2
if "%opcion%"=="3" goto opcion3
if "%opcion%"=="4" goto opcion4
if "%opcion%"=="5" goto opcion5
if "%opcion%"=="6" goto opcion6
if "%opcion%"=="10" goto salir

echo Opci√≥n invalida.
pause
goto menu

:opcion0
    cls
    cd C:\Archivos de programa\Oracle\VirtualBox
    echo. Has elegido la opcion No. 0
    echo.
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
    echo Proporcione el nombre del Snapshot: 
    set /p snap=nombreSnapshot= 
        echo Tomando Snapshot...
        VBoxManage snapshot "%dato1%" take "%snap%"
        color 0C
    echo.
        color 0C
    pause

goto menu


:opcion1
    cls
    echo. Has elegido la opcion Restaurar VM a partir de Snapshot
    echo.
    cd C:\Archivos de programa\Oracle\VirtualBox
    echo Proporcione el nombre de VM: 
    set /p dato1=nombreVM= 
    echo Proporcione el nombre del Snapshot: 
    set /p snap=nombreSnapshot= 
	echo Restaurando VM...
	VBoxManage snapshot "%dato1%" restore "%snap%"
        color 0C
    pause

goto menu

:opcion2
    cls
    echo Conectando a %dato1%...
    ::set /p usuario=Ingrese el usuario de SSH (Enter para usar por defecto embo):
    set /p usuario=Ingrese el usuario de SSH (Enter para usar por defecto kary):
    if "%usuario%"=="" set usuario=kary
    ::if "%usuario%"=="" set usuario=embo
    ::set /p servidor=Ingrese la direccion del servidor SSH (Enter para usar por defecto 192.168.10.183):
    set /p servidor=Ingrese la direccion del servidor SSH (Enter para usar por defecto 192.168.1.100):
    ::if "%servidor%"=="" set servidor=192.168.10.183
    if "%servidor%"=="" set servidor=192.168.1.100
    rem set /p puerto=Ingrese el puerto de SSH (Enter para usar el valor por defecto 22):
    rem if "%puerto%"=="" set puerto=22
    rem set /p archivos=Digite la ruta de los archivo (Enter para usar el valor por defecto C:\Users\embo\Desktop\Mlwr_Lab _Work_Dir):
    ::if "%archivos%"=="" set archivos=C:\Users\embo\Desktop\Mlwr_Lab_Work_Dir
    if "%archivos%"=="" set archivos=C:\Users\Karina\Desktop\Analisis-y-Deteccion-de-Malware\Laboratorio2\Mlwr_Lab_Work_Dir
    scp -r %archivos% %usuario%@%servidor%:/home/%usuario%/
    ssh %usuario%@%servidor% -t "cd Mlwr_Lab_Work_Dir && chmod +x laboratorio.sh && chmod +x prom.sh"
    
    pause
goto menu

:opcion3
    cls
    echo Analizar Archivo:
    set /p rutaarchivo=Ingrese la direccion del archivo (Enter para usar por defecto ../Escritorio/metro.pdf):
    if "%rutaarchivo%"=="" set rutaarchivo=../Escritorio/metro.pdf
    ssh %usuario%@%servidor% -t "cd Mlwr_Lab_Work_Dir && ./prom.sh  %rutaarchivo% "
    pause
goto menu

:opcion4
    cls
    echo Analizar Carpeta:
    set /p rutacarpeta=Ingrese la direccion del archivo (Enter para usar por defecto ../Escritorio/docs):
    if "%rutacarpeta%"=="" set rutacarpeta=../Escritorio/docs
    ssh %usuario%@%servidor% -t "cd Mlwr_Lab_Work_Dir && ./prom.sh  %rutacarpeta% "
    pause
goto menu

:opcion5
    cls
    echo Analisis especifico de un archivo de configuracion:
    set /p rutajson=Ingrese la direccion del json (Enter para usar por defecto ../Escritorio/metro.pdf):
    if "%rutajson%"=="" set %rutajson%=Experimentos/AnalisisEstatico.json
    ssh %usuario%@%servidor% -t "cd Mlwr_Lab_Work_Dir &&  ./prom.sh  %rutajson% "
    pause
goto menu


:opcion6
    echo Analisis especifico de un archivo de configuracion con ruta:
    set /p rutaarchivo=Ingrese la direccion del archivo (Enter para usar por defecto ../Escritorio/metro.pdf):
    if "%rutaarchivo%"=="" set rutaarchivo=../Escritorio/metro.pdf
    ssh %usuario%@%servidor% -t "cd Mlwr_Lab_Work_Dir &&  ./laboratorio.sh Experimentos/AnalisisEstatico.json %rutaarchivo% "
    pause
goto menu

:salir
echo Adios!
exit
